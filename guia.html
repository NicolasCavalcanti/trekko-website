<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-S816P190VN"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-S816P190VN');
    </script>
    
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2482023752745520"
         crossorigin="anonymous"></script>
    <meta name="google-adsense-account" content="ca-pub-2482023752745520">
    

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil do Guia - Trekko</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <a href="https://www.trekko.com.br/" class="text-2xl font-bold text-green-600">Trekko</a>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="https://www.trekko.com.br/" class="text-gray-500 hover:text-green-600 px-3 py-2 rounded-md text-sm font-medium">In√≠cio</a>
                        <a href="trilhas.html" class="text-gray-500 hover:text-green-600 px-3 py-2 rounded-md text-sm font-medium">Trilhas</a>
                        <a href="guias.html" class="text-gray-500 hover:text-green-600 px-3 py-2 rounded-md text-sm font-medium">Guias</a>
                        <a href="sobre.html" class="text-gray-500 hover:text-green-600 px-3 py-2 rounded-md text-sm font-medium">Sobre</a>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <!-- Bot√µes de autentica√ß√£o ser√£o inseridos aqui pelo auth.js -->
                    <div id="authButtons">
                        <button id="loginBtn" class="text-green-600 hover:text-green-700 px-3 py-2 rounded-md text-sm font-medium">Entrar</button>
                        <button id="registerBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm font-medium">Cadastrar</button>
                    </div>
                    <!-- Menu do usu√°rio logado -->
                    <div id="userMenu" class="relative hidden">
                        <button id="userMenuBtn" class="flex items-center space-x-2 text-gray-700 hover:text-green-600">
                            <div class="w-8 h-8 bg-green-600 rounded-full flex items-center justify-center text-white text-sm font-medium">
                                <span id="userInitial">U</span>
                            </div>
                            <span id="userName">Usu√°rio</span>
                        </button>
                        <div id="userDropdown" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg hidden">
                            <a href="perfil.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Meu Perfil</a>
                            <button id="logoutBtn" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Sair</button>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <!-- Loading -->
    <div id="loading" class="max-w-4xl mx-auto px-4 py-12 text-center">
        <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"></div>
        <p class="mt-4 text-gray-600 text-lg">Carregando perfil do guia...</p>
    </div>

    <!-- Error -->
    <div id="error" class="max-w-4xl mx-auto px-4 py-12 text-center hidden">
        <div class="bg-red-50 border border-red-200 rounded-lg p-8">
            <h2 class="text-2xl font-bold text-red-800 mb-4">Guia n√£o encontrado</h2>
            <p class="text-red-600 mb-6">O guia que voc√™ est√° procurando n√£o existe ou foi removido.</p>
            <a href="guias.html" class="bg-orange-500 hover:bg-orange-600 text-white px-6 py-3 rounded-lg font-medium inline-block">
                ‚Üê Voltar para Guias
            </a>
        </div>
    </div>

    <!-- Guide Profile -->
    <div id="guideProfile" class="max-w-4xl mx-auto px-4 py-8 hidden">
        <!-- Back Button -->
        <div class="mb-6">
            <a href="guias.html" class="text-green-600 hover:text-green-700 font-medium">
                ‚Üê Voltar para Guias
            </a>
        </div>

        <!-- Header do Guia -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
            <div class="flex flex-col md:flex-row items-start md:items-center space-y-4 md:space-y-0 md:space-x-6">
                <div class="w-24 h-24 bg-gradient-to-br from-green-400 to-blue-500 rounded-full flex items-center justify-center text-white text-3xl font-bold">
                    <span id="guideInitial">G</span>
                </div>
                <div class="flex-1">
                    <div class="flex items-center space-x-2 mb-2">
                        <h1 id="guideName" class="text-2xl font-bold text-gray-900">Nome do Guia</h1>
                        <span class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded-full">Verificado</span>
                    </div>
                    <p id="guideLocation" class="text-gray-600 mb-2">üìç Localiza√ß√£o</p>
                    <p id="guideCadastur" class="text-sm text-gray-500 mb-2">Certifica√ß√£o: Cadastur</p>
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center">
                            <span class="text-yellow-400">‚≠ê</span>
                            <span id="guideRating" class="ml-1 text-sm font-medium text-gray-900">4.8</span>
                            <span id="guideReviewCount" class="ml-1 text-sm text-gray-500">(24 avalia√ß√µes)</span>
                        </div>
                        <span id="guidePrice" class="text-green-600 font-semibold">R$ 150/dia</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Informa√ß√µes do Guia -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
            <div class="lg:col-span-2">
                <!-- Sobre o Guia -->
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <h2 class="text-xl font-semibold text-gray-900 mb-4">Sobre o Guia</h2>
                    <p id="guideBio" class="text-gray-600 leading-relaxed">Biografia do guia...</p>
                </div>

                <!-- Trilhas que Conduz -->
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <h2 class="text-xl font-semibold text-gray-900 mb-4">Trilhas que Conduz</h2>
                    <div id="guideTrails" class="space-y-3">
                        <!-- Trilhas ser√£o carregadas aqui -->
                    </div>
                </div>

                <!-- Se√ß√£o de Avalia√ß√µes -->
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-semibold text-gray-900">Avalia√ß√µes</h2>
                        <button id="addReviewBtn" onclick="openGuideReviewModal()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium">
                            ‚≠ê Avaliar Guia
                        </button>
                    </div>

                    <!-- Estat√≠sticas de Avalia√ß√£o -->
                    <div class="grid grid-cols-3 gap-4 mb-6 p-4 bg-gray-50 rounded-lg">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-gray-900" id="avgRating">0.0</div>
                            <div class="text-sm text-gray-500">M√©dia Geral</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-gray-900" id="totalReviews">0</div>
                            <div class="text-sm text-gray-500">Avalia√ß√µes</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-gray-900" id="recommendationRate">0%</div>
                            <div class="text-sm text-gray-500">Recomendam</div>
                        </div>
                    </div>

                    <!-- Lista de Avalia√ß√µes -->
                    <div id="reviewsList" class="space-y-4">
                        <!-- Avalia√ß√µes ser√£o carregadas aqui -->
                    </div>

                    <!-- Mensagem quando n√£o h√° avalia√ß√µes -->
                    <div id="noReviews" class="text-center py-8 text-gray-500 hidden">
                        <p>Ainda n√£o h√° avalia√ß√µes para este guia.</p>
                        <p class="text-sm mt-2">Seja o primeiro a avaliar!</p>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="space-y-6">
                <!-- Informa√ß√µes R√°pidas -->
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Informa√ß√µes</h3>
                    <div class="space-y-3">
                        <div class="flex items-center">
                            <span class="text-gray-400 mr-3">üó£Ô∏è</span>
                            <span id="guideLanguages" class="text-gray-600">Portugu√™s</span>
                        </div>
                        <div class="flex items-center">
                            <span class="text-gray-400 mr-3">üìß</span>
                            <span id="guideEmail" class="text-gray-600">email@exemplo.com</span>
                        </div>
                        <div class="flex items-center">
                            <span class="text-gray-400 mr-3">‚è∞</span>
                            <span class="text-gray-600">Resposta r√°pida</span>
                        </div>
                    </div>
                </div>

                <!-- A√ß√µes -->
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Contato</h3>
                    <div class="space-y-3">
                        <button class="w-full bg-green-600 hover:bg-green-700 text-white py-3 px-4 rounded-lg font-medium">
                            üí¨ Enviar Mensagem
                        </button>
                        <button class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg font-medium">
                            üì± WhatsApp
                        </button>
                        <button class="w-full border border-gray-300 hover:bg-gray-50 text-gray-700 py-3 px-4 rounded-lg font-medium">
                            ‚ù§Ô∏è Salvar nos Favoritos
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Avalia√ß√£o -->
    <div id="reviewModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-md w-full p-6 max-h-screen overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-900">Avaliar Guia</h3>
                    <button id="closeReviewModal" class="text-gray-400 hover:text-gray-600">
                        <span class="text-2xl">√ó</span>
                    </button>
                </div>

                <form id="reviewForm">
                    <!-- Informa√ß√µes do Guia no Modal -->
                    <div class="flex items-center space-x-3 mb-4 p-3 bg-gray-50 rounded-lg">
                        <div class="w-12 h-12 bg-gradient-to-br from-green-400 to-blue-500 rounded-full flex items-center justify-center text-white text-lg font-bold">
                            <span id="modalGuideInitial">G</span>
                        </div>
                        <div>
                            <div class="font-medium text-gray-900" id="modalGuideName">Nome do Guia</div>
                            <div class="text-sm text-gray-500" id="modalGuideLocation">Localiza√ß√£o</div>
                        </div>
                    </div>

                    <!-- Avalia√ß√£o Geral -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Avalia√ß√£o Geral</label>
                        <div class="flex space-x-1" id="overallRating">
                            <button type="button" class="star-btn text-2xl text-gray-300 hover:text-yellow-400" data-rating="1">‚≠ê</button>
                            <button type="button" class="star-btn text-2xl text-gray-300 hover:text-yellow-400" data-rating="2">‚≠ê</button>
                            <button type="button" class="star-btn text-2xl text-gray-300 hover:text-yellow-400" data-rating="3">‚≠ê</button>
                            <button type="button" class="star-btn text-2xl text-gray-300 hover:text-yellow-400" data-rating="4">‚≠ê</button>
                            <button type="button" class="star-btn text-2xl text-gray-300 hover:text-yellow-400" data-rating="5">‚≠ê</button>
                        </div>
                    </div>

                    <!-- Trilha Realizada -->
                    <div class="mb-4">
                        <label for="trailName" class="block text-sm font-medium text-gray-700 mb-2">Trilha Realizada</label>
                        <input type="text" id="trailName" name="trailName" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500"
                               placeholder="Nome da trilha que voc√™ fez com este guia">
                    </div>

                    <!-- Coment√°rio -->
                    <div class="mb-4">
                        <label for="reviewComment" class="block text-sm font-medium text-gray-700 mb-2">Coment√°rio</label>
                        <textarea id="reviewComment" name="reviewComment" rows="4" 
                                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500"
                                  placeholder="Conte sobre sua experi√™ncia com este guia... (m√≠nimo 20 caracteres)"></textarea>
                        <div class="text-sm text-gray-500 mt-1">
                            <span id="commentCount">0</span>/500 caracteres
                        </div>
                    </div>

                    <!-- Recomenda√ß√£o -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Voc√™ recomenda este guia?</label>
                        <div class="flex space-x-4">
                            <label class="flex items-center">
                                <input type="radio" name="recommend" value="yes" class="text-green-600 focus:ring-green-500">
                                <span class="ml-2 text-sm text-gray-700">üëç Sim, recomendo</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="recommend" value="no" class="text-red-600 focus:ring-red-500">
                                <span class="ml-2 text-sm text-gray-700">üëé N√£o recomendo</span>
                            </label>
                        </div>
                    </div>

                    <!-- Bot√µes -->
                    <div class="flex space-x-3">
                        <button type="button" id="cancelReview" 
                                class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                            Cancelar
                        </button>
                        <button type="submit" id="submitReview"
                                class="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed">
                            Enviar Avalia√ß√£o
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-12 mt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-lg font-semibold mb-4">Trekko</h3>
                    <p class="text-gray-400">A plataforma mais completa para conectar trilheiros e guias em todo o Brasil.</p>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-4">Trilhas</h4>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="trilhas.html" class="hover:text-white">Descobrir Trilhas</a></li>
                        <li><a href="#" class="hover:text-white">Trilhas Populares</a></li>
                        <li><a href="#" class="hover:text-white">Trilhas por Estado</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-4">Guias</h4>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="guias.html" class="hover:text-white">Encontrar Guias</a></li>
                        <li><a href="#" class="hover:text-white">Tornar-se Guia</a></li>
                        <li><a href="#" class="hover:text-white">Certifica√ß√£o</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-4">Suporte</h4>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="#" class="hover:text-white">Central de Ajuda</a></li>
                        <li><a href="#" class="hover:text-white">Contato</a></li>
                        <li><a href="#" class="hover:text-white">Termos de Uso</a></li>
                        <li><a href="#" class="hover:text-white">Privacidade</a></li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400">
                <p>&copy; 2025 Trekko. Todos os direitos reservados.</p>
            </div>
        </div>
    </footer>

    <!-- Sistema de Autentica√ß√£o Global -->
    <script src="auth.js"></script>

    <script>
        // API Configuration
        const API_BASE_URL = 'http://localhost:5000';
        const API_URL = `${API_BASE_URL}/api`;

        console.log('üîß API configurada:', API_BASE_URL);

        // Variables
        let currentGuide = null;
        let currentRating = 0;

        // Get guide ID from URL
        function getGuideIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id');
        }

        // Load guide profile
        async function loadGuideProfile() {
            const guideId = getGuideIdFromUrl();
            
            if (!guideId) {
                console.error('‚ùå ID do guia n√£o fornecido');
                showError();
                return;
            }

            console.log('üîÑ Carregando perfil do guia ID:', guideId);

            try {
                const url = `${API_URL}/guides/${guideId}`;
                console.log('üåê URL da API:', url);

                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    mode: 'cors'
                });
                console.log('üì° Status da resposta:', response.status);

                if (!response.ok) {
                    if (response.status === 404) {
                        console.log('‚ö†Ô∏è Guia n√£o encontrado na API, tentando dados locais...');
                        // Tentar carregar dados locais como fallback
                        const localGuide = getLocalGuideData(guideId);
                        if (localGuide) {
                            console.log('‚úÖ Dados locais encontrados:', localGuide);
                            // Garantir que dados locais tamb√©m estejam zerados
                            localGuide.average_rating = 0;
                            localGuide.total_reviews = 0;
                            localGuide.trails = [];
                            currentGuide = localGuide;
                            displayGuideProfile(localGuide);
                            loadGuideReviews(guideId);
                            return;
                        }
                        throw new Error('Guia n√£o encontrado');
                    }
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }

                const guide = await response.json();
                console.log('‚úÖ Dados do guia carregados:', guide);

                // For√ßar estado inicial limpo - zerar dados mockados da API
                guide.average_rating = 0;
                guide.total_reviews = 0;
                guide.trails = []; // Remover trilhas da API
                console.log('üßπ Dados limpos para estado inicial:', guide);

                currentGuide = guide;
                displayGuideProfile(guide);
                loadGuideReviews(guideId);

            } catch (error) {
                console.error('‚ùå Erro ao carregar guia:', error);
                
                // √öltimo recurso: tentar dados locais
                const localGuide = getLocalGuideData(guideId);
                if (localGuide) {
                    console.log('üîÑ Usando dados locais como fallback:', localGuide);
                    // Garantir que dados locais estejam zerados
                    localGuide.average_rating = 0;
                    localGuide.total_reviews = 0;
                    localGuide.trails = [];
                    currentGuide = localGuide;
                    displayGuideProfile(localGuide);
                    loadGuideReviews(guideId);
                } else {
                    showError();
                }
            }
        }

        // Get local guide data as fallback
        function getLocalGuideData(guideId) {
            // Dados de exemplo para demonstra√ß√£o
            const sampleGuides = {
                '1': {
                    id: 1,
                    name: 'Carlos Silva',
                    operating_regions: 'Serra da Mantiqueira',
                    operating_states: 'MG, SP, RJ',
                    cadastur_number: '12345678901',
                    average_rating: 0,
                    total_reviews: 0,
                    daily_rate: 'R$ 350/dia',
                    biography: 'Guia profissional especialista em trilhas de montanha. Especialista em alta montanha e travessias de longa dura√ß√£o.',
                    languages: ['Portugu√™s', 'Ingl√™s', 'Espanhol'],
                    email: 'carlos@exemplo.com',
                    trails: []
                },
                '2': {
                    id: 2,
                    name: 'Ana Costa',
                    operating_regions: 'Chapada Diamantina',
                    operating_states: 'BA',
                    cadastur_number: '98765432109',
                    average_rating: 0,
                    total_reviews: 0,
                    daily_rate: 'R$ 280/dia',
                    biography: 'Guia especializada em ecoturismo e trilhas na Chapada Diamantina. Bi√≥loga com paix√£o pela natureza e conserva√ß√£o.',
                    languages: ['Portugu√™s', 'Ingl√™s'],
                    email: 'ana@exemplo.com',
                    trails: []
                }
            };
            
            return sampleGuides[guideId] || null;
        }

        // Display guide profile
        function displayGuideProfile(guide) {
            const guideId = guide.id || getGuideIdFromUrl(); // Usar ID do guide ou da URL
            
            // Hide loading and show profile
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('guideProfile').classList.remove('hidden');

            // Basic info
            document.getElementById('guideName').textContent = guide.name || 'Nome n√£o dispon√≠vel';
            document.getElementById('guideLocation').textContent = `üìç ${guide.operating_regions || ''}, ${guide.operating_states || ''}`;
            document.getElementById('guideCadastur').textContent = `Certifica√ß√£o: Cadastur: ${guide.cadastur_number || 'N/A'}`;
            
            // Profile initial
            const initial = guide.name ? guide.name.charAt(0).toUpperCase() : 'G';
            document.getElementById('guideInitial').textContent = initial;
            document.getElementById('modalGuideInitial').textContent = initial;

            // Modal info
            document.getElementById('modalGuideName').textContent = guide.name || 'Nome n√£o dispon√≠vel';
            document.getElementById('modalGuideLocation').textContent = `${guide.operating_regions || ''}, ${guide.operating_states || ''}`;

            // Stats
            document.getElementById('guideRating').textContent = guide.average_rating || '4.5';
            document.getElementById('guideReviewCount').textContent = `(${guide.total_reviews || '0'} avalia√ß√µes)`;
            document.getElementById('guidePrice').textContent = guide.daily_rate || 'Sob consulta';

            // Biography
            document.getElementById('guideBio').textContent = guide.biography || 'Biografia n√£o dispon√≠vel.';

            // Languages
            document.getElementById('guideLanguages').textContent = guide.languages ? guide.languages.join(', ') : 'Portugu√™s';

            // Email
            document.getElementById('guideEmail').textContent = guide.email || 'email@exemplo.com';

            // Trails - Load from guide's profile activities
            const trailsContainer = document.getElementById('guideTrails');
            trailsContainer.innerHTML = '';
            
            // Try to load trails from guide's profile activities first
            const guideTrails = JSON.parse(localStorage.getItem(`guide_trails_${guideId}`) || '[]');
            
            if (guideTrails.length > 0) {
                guideTrails.forEach(trail => {
                    const trailDiv = document.createElement('div');
                    trailDiv.className = 'border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow';
                    trailDiv.innerHTML = `
                        <h4 class="font-medium text-gray-900 mb-2">${trail.name}</h4>
                        <div class="text-sm text-gray-600 space-y-1">
                            <div>üìç ${trail.location}</div>
                            <div>üèîÔ∏è Dificuldade: ${trail.difficulty}</div>
                            <div>üìè Dist√¢ncia: ${trail.distance}</div>
                            ${trail.duration ? `<div>‚è±Ô∏è Dura√ß√£o: ${trail.duration}</div>` : ''}
                            ${trail.price ? `<div>üí∞ Valor: ${trail.price}</div>` : ''}
                        </div>
                        ${trail.photos && trail.photos.length > 0 ? `
                            <div class="flex space-x-2 mt-3">
                                ${trail.photos.slice(0, 3).map(photo => `
                                    <img src="${photo}" alt="Foto da trilha" class="w-16 h-16 rounded object-cover cursor-pointer" onclick="openImageModal('${photo}')">
                                `).join('')}
                                ${trail.photos.length > 3 ? `<div class="w-16 h-16 bg-gray-100 rounded flex items-center justify-center text-xs text-gray-500">+${trail.photos.length - 3}</div>` : ''}
                            </div>
                        ` : ''}
                        ${trail.description ? `<p class="text-sm text-gray-600 mt-2">${trail.description}</p>` : ''}
                    `;
                    trailsContainer.appendChild(trailDiv);
                });
            } else {
                // Show message encouraging guide to add trails
                trailsContainer.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <div class="text-4xl mb-4">üèîÔ∏è</div>
                        <p class="text-lg font-medium mb-2">Nenhuma trilha cadastrada ainda</p>
                        <p class="text-sm">Como guia, voc√™ pode adicionar trilhas ao seu perfil para atrair mais clientes.</p>
                        <p class="text-sm mt-2 text-green-600">üí° Dica: Acesse "Meu Perfil" para adicionar suas trilhas!</p>
                    </div>
                `;
            }

            // Stats
            document.getElementById('avgRating').textContent = guide.average_rating || '0.0';
            document.getElementById('totalReviews').textContent = guide.total_reviews || '0';
            document.getElementById('recommendationRate').textContent = guide.total_reviews > 0 ? calculateRecommendationRate(guideId) : '0%';
        }

        // Calculate real recommendation rate based on reviews
        function calculateRecommendationRate(guideId) {
            const reviews = getGuideReviews(guideId);
            if (reviews.length === 0) return '0%';
            
            const recommendCount = reviews.filter(review => review.recommend === 'yes').length;
            const rate = Math.round((recommendCount / reviews.length) * 100);
            return `${rate}%`;
        }

        // Show error
        function showError() {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('error').classList.remove('hidden');
        }

        // Load guide reviews
        function loadGuideReviews(guideId) {
            // Load reviews from localStorage
            const reviews = getGuideReviews(guideId);
            displayReviews(reviews);
        }

        // Get guide reviews from localStorage
        function getGuideReviews(guideId) {
            const allReviews = JSON.parse(localStorage.getItem('guideReviews') || '{}');
            return allReviews[guideId] || [];
        }

        // Save guide review to localStorage
        function saveGuideReview(guideId, review) {
            const allReviews = JSON.parse(localStorage.getItem('guideReviews') || '{}');
            if (!allReviews[guideId]) {
                allReviews[guideId] = [];
            }
            allReviews[guideId].push(review);
            localStorage.setItem('guideReviews', JSON.stringify(allReviews));
        }

        // Display reviews
        function displayReviews(reviews) {
            const reviewsList = document.getElementById('reviewsList');
            const noReviews = document.getElementById('noReviews');

            if (reviews.length === 0) {
                reviewsList.classList.add('hidden');
                noReviews.classList.remove('hidden');
                return;
            }

            noReviews.classList.add('hidden');
            reviewsList.classList.remove('hidden');
            reviewsList.innerHTML = '';

            reviews.forEach(review => {
                const reviewDiv = document.createElement('div');
                reviewDiv.className = 'border border-gray-200 rounded-lg p-4';
                reviewDiv.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-green-600 rounded-full flex items-center justify-center text-white font-medium">
                                ${review.userName.charAt(0).toUpperCase()}
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-900">${review.userName}</h4>
                                <div class="text-sm text-gray-500">${review.date}</div>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <span class="text-yellow-400">${'‚≠ê'.repeat(review.rating)}</span>
                            <span class="ml-1 text-sm text-gray-600">${review.rating}/5</span>
                        </div>
                    </div>
                    ${review.trailName ? `<div class="text-sm text-gray-600 mb-2">ü•æ Trilha: ${review.trailName}</div>` : ''}
                    <p class="text-gray-700 mb-3">${review.comment}</p>
                    <div class="flex items-center justify-between">
                        <div class="text-sm ${review.recommend === 'yes' ? 'text-green-600' : 'text-red-600'}">
                            ${review.recommend === 'yes' ? 'üëç Recomenda este guia' : 'üëé N√£o recomenda este guia'}
                        </div>
                    </div>
                `;
                reviewsList.appendChild(reviewDiv);
            });

            // Update stats
            updateReviewStats(reviews);
        }

        // Update review statistics
        function updateReviewStats(reviews) {
            if (reviews.length === 0) return;

            const totalRating = reviews.reduce((sum, review) => sum + review.rating, 0);
            const avgRating = (totalRating / reviews.length).toFixed(1);
            const recommendCount = reviews.filter(review => review.recommend === 'yes').length;
            const recommendRate = Math.round((recommendCount / reviews.length) * 100);

            document.getElementById('avgRating').textContent = avgRating;
            document.getElementById('totalReviews').textContent = reviews.length;
            document.getElementById('recommendationRate').textContent = `${recommendRate}%`;
            document.getElementById('guideRating').textContent = avgRating;
            document.getElementById('guideReviewCount').textContent = `(${reviews.length} avalia√ß√µes)`;
        }

        // Check if user is logged in
        function isUserLoggedIn() {
            const userData = localStorage.getItem('userData');
            return userData !== null && userData !== 'null';
        }

        // Get current user
        function getCurrentUser() {
            const userData = localStorage.getItem('userData');
            return userData ? JSON.parse(userData) : null;
        }

        // Check if user already reviewed this guide
        function hasUserReviewedGuide(guideId, userId) {
            const reviews = getGuideReviews(guideId);
            return reviews.some(review => review.userId === userId);
        }

        // Setup review modal
        function setupReviewModal() {
            const addReviewBtn = document.getElementById('addReviewBtn');
            const reviewModal = document.getElementById('reviewModal');
            const closeReviewModal = document.getElementById('closeReviewModal');
            const cancelReview = document.getElementById('cancelReview');
            const reviewForm = document.getElementById('reviewForm');
            const commentTextarea = document.getElementById('reviewComment');
            const commentCount = document.getElementById('commentCount');

            // Add review button click
            addReviewBtn.addEventListener('click', () => {
                if (!isUserLoggedIn()) {
                    alert('Voc√™ precisa estar logado para avaliar um guia. Fa√ßa login ou cadastre-se.');
                    return;
                }

                const user = getCurrentUser();
                const guideId = getGuideIdFromUrl();

                if (hasUserReviewedGuide(guideId, user.id)) {
                    alert('Voc√™ j√° avaliou este guia. Cada usu√°rio pode fazer apenas uma avalia√ß√£o por guia.');
                    return;
                }

                reviewModal.classList.remove('hidden');
                resetReviewForm();
            });

            // Close modal
            closeReviewModal.addEventListener('click', () => {
                reviewModal.classList.add('hidden');
            });

            cancelReview.addEventListener('click', () => {
                reviewModal.classList.add('hidden');
            });

            // Click outside modal to close
            reviewModal.addEventListener('click', (e) => {
                if (e.target === reviewModal) {
                    reviewModal.classList.add('hidden');
                }
            });

            // Character count
            commentTextarea.addEventListener('input', () => {
                const count = commentTextarea.value.length;
                commentCount.textContent = count;
                
                if (count > 500) {
                    commentTextarea.value = commentTextarea.value.substring(0, 500);
                    commentCount.textContent = 500;
                }
            });

            // Star rating
            setupStarRating();

            // Form submission
            reviewForm.addEventListener('submit', handleReviewSubmission);
        }

        // Open guide review modal
        function openGuideReviewModal() {
            if (!isUserLoggedIn()) {
                alert('Voc√™ precisa estar logado para avaliar um guia. Fa√ßa login ou cadastre-se.');
                return;
            }

            const user = getCurrentUser();
            const guideId = getGuideIdFromUrl();

            if (hasUserReviewedGuide(guideId, user.id)) {
                alert('Voc√™ j√° avaliou este guia. Cada usu√°rio pode fazer apenas uma avalia√ß√£o por guia.');
                return;
            }

            document.getElementById('reviewModal').classList.remove('hidden');
            resetReviewForm();
        }

        // Setup star rating
        function setupStarRating() {
            const starButtons = document.querySelectorAll('.star-btn');
            
            starButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    e.preventDefault();
                    const rating = parseInt(button.dataset.rating);
                    currentRating = rating;
                    
                    // Update star display
                    starButtons.forEach((star, index) => {
                        if (index < rating) {
                            star.classList.remove('text-gray-300');
                            star.classList.add('text-yellow-400');
                        } else {
                            star.classList.remove('text-yellow-400');
                            star.classList.add('text-gray-300');
                        }
                    });
                });
            });
        }

        // Reset review form
        function resetReviewForm() {
            currentRating = 0;
            document.getElementById('reviewForm').reset();
            document.getElementById('commentCount').textContent = '0';
            
            // Reset stars
            document.querySelectorAll('.star-btn').forEach(star => {
                star.classList.remove('text-yellow-400');
                star.classList.add('text-gray-300');
            });
        }

        // Handle review submission
        function handleReviewSubmission(e) {
            e.preventDefault();
            
            const user = getCurrentUser();
            const guideId = getGuideIdFromUrl();
            const trailName = document.getElementById('trailName').value.trim();
            const comment = document.getElementById('reviewComment').value.trim();
            const recommend = document.querySelector('input[name="recommend"]:checked')?.value;

            // Validation
            if (currentRating === 0) {
                alert('Por favor, selecione uma avalia√ß√£o de 1 a 5 estrelas.');
                return;
            }

            if (comment.length < 20) {
                alert('O coment√°rio deve ter pelo menos 20 caracteres.');
                return;
            }

            if (!recommend) {
                alert('Por favor, indique se voc√™ recomenda este guia.');
                return;
            }

            // Create review object
            const review = {
                id: Date.now(),
                userId: user.id,
                userName: user.name,
                guideId: guideId,
                rating: currentRating,
                trailName: trailName,
                comment: comment,
                recommend: recommend,
                date: new Date().toLocaleDateString('pt-BR')
            };

            // Save review
            saveGuideReview(guideId, review);

            // Update display
            const reviews = getGuideReviews(guideId);
            displayReviews(reviews);

            // Close modal
            document.getElementById('reviewModal').classList.add('hidden');

            // Show success message
            alert('Avalia√ß√£o enviada com sucesso! Obrigado pelo seu feedback.');
        }

        // Image modal function
        function openImageModal(imageSrc) {
            // Create modal if it doesn't exist
            let imageModal = document.getElementById('imageModal');
            if (!imageModal) {
                imageModal = document.createElement('div');
                imageModal.id = 'imageModal';
                imageModal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden';
                imageModal.innerHTML = `
                    <div class="relative max-w-4xl max-h-full p-4">
                        <img id="modalImage" src="" alt="Imagem ampliada" class="max-w-full max-h-full object-contain rounded-lg">
                        <button onclick="closeImageModal()" class="absolute top-2 right-2 bg-white bg-opacity-20 hover:bg-opacity-30 text-white rounded-full w-10 h-10 flex items-center justify-center text-xl">
                            √ó
                        </button>
                    </div>
                `;
                document.body.appendChild(imageModal);
                
                // Close on click outside
                imageModal.addEventListener('click', (e) => {
                    if (e.target === imageModal) {
                        closeImageModal();
                    }
                });
            }
            
            document.getElementById('modalImage').src = imageSrc;
            imageModal.classList.remove('hidden');
        }

        function closeImageModal() {
            const imageModal = document.getElementById('imageModal');
            if (imageModal) {
                imageModal.classList.add('hidden');
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Inicializando p√°gina de detalhes do guia...');
            loadGuideProfile();
            setupReviewModal();
        });
    </script>
</body>
</html>

