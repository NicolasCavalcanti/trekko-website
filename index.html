<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trekko - Sua plataforma de trekking no Brasil</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hero-bg {
            background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), 
                        url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800"><rect fill="%23059669" width="1200" height="800"/><path fill="%23047857" d="M0,400 Q300,200 600,400 T1200,400 L1200,800 L0,800 Z"/></svg>');
            background-size: cover;
            background-position: center;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <span class="text-2xl font-bold text-green-600">Trekko</span>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="#" class="text-gray-900 hover:text-green-600 px-3 py-2 rounded-md text-sm font-medium">In√≠cio</a>
                        <a href="trilhas.html" class="text-gray-500 hover:text-green-600 px-3 py-2 rounded-md text-sm font-medium">Trilhas</a>
                        <a href="guias.html" class="text-gray-500 hover:text-green-600 px-3 py-2 rounded-md text-sm font-medium">Guias</a>
                        <a href="#" class="text-gray-500 hover:text-green-600 px-3 py-2 rounded-md text-sm font-medium">Sobre</a>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="loginBtn" class="text-green-600 hover:text-green-700 px-3 py-2 rounded-md text-sm font-medium">Entrar</button>
                    <button id="registerBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm font-medium">Cadastrar</button>
                    
                    <!-- User Menu (hidden by default) -->
                    <div id="userMenu" class="hidden relative">
                        <button id="userMenuBtn" class="flex items-center space-x-2 text-gray-700 hover:text-green-600">
                            <span id="userName" class="font-medium"></span>
                            <span class="text-sm">‚ñº</span>
                        </button>
                        <div id="userDropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50">
                            <a href="perfil.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Meu Perfil</a>
                            <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Configura√ß√µes</a>
                            <button id="logoutBtn" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Sair</button>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <!-- Hero Section -->
    <section class="hero-bg h-96 flex items-center justify-center text-center text-white">
        <div class="max-w-4xl mx-auto px-4">
            <h1 class="text-4xl md:text-6xl font-bold mb-4">
                Conecte-se com a <span class="text-orange-400">natureza</span>
            </h1>
            <p class="text-xl md:text-2xl mb-8">
                Descubra trilhas incr√≠veis, encontre guias experientes e planeje suas pr√≥ximas aventuras no Brasil
            </p>
            <a href="guias.html" class="bg-orange-500 hover:bg-orange-600 text-white px-8 py-3 rounded-lg text-lg font-semibold inline-block">
                Buscar Aventuras
            </a>
        </div>
    </section>

    <!-- Login Modal -->
    <div id="loginModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-900">Entrar</h2>
                <button id="closeLoginModal" class="text-gray-400 hover:text-gray-600">
                    <span class="text-2xl">&times;</span>
                </button>
            </div>
            
            <form id="loginForm">
                <div class="mb-4">
                    <label for="loginEmail" class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input type="email" id="loginEmail" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                </div>
                
                <div class="mb-6">
                    <label for="loginPassword" class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                    <input type="password" id="loginPassword" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                </div>
                
                <div id="loginError" class="hidden mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded"></div>
                
                <button type="submit" id="loginSubmit" 
                        class="w-full bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-md font-medium">
                    Entrar
                </button>
            </form>
            
            <div class="mt-4 text-center">
                <p class="text-sm text-gray-600">
                    N√£o tem uma conta? 
                    <button id="switchToRegister" class="text-green-600 hover:text-green-700 font-medium">Cadastre-se</button>
                </p>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4 max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-900">Cadastrar</h2>
                <button id="closeRegisterModal" class="text-gray-400 hover:text-gray-600">
                    <span class="text-2xl">&times;</span>
                </button>
            </div>
            
            <form id="registerForm">
                <div class="mb-4">
                    <label for="registerName" class="block text-sm font-medium text-gray-700 mb-2">Nome Completo</label>
                    <input type="text" id="registerName" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                </div>
                
                <div class="mb-4">
                    <label for="registerEmail" class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input type="email" id="registerEmail" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                </div>
                
                <div class="mb-4">
                    <label for="registerPassword" class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                    <input type="password" id="registerPassword" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                    <p class="text-xs text-gray-500 mt-1">M√≠nimo 8 caracteres, com mai√∫scula, min√∫scula e n√∫mero</p>
                </div>
                
                <div class="mb-4">
                    <label for="registerUserType" class="block text-sm font-medium text-gray-700 mb-2">Tipo de Usu√°rio</label>
                    <select id="registerUserType" required 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 bg-white text-gray-900">
                        <option value="" class="text-gray-500">Selecione o tipo de usu√°rio...</option>
                        <option value="trekker" class="text-gray-900">ü•æ Trekker (Usu√°rio)</option>
                        <option value="guia" class="text-gray-900">üß≠ Guia Profissional</option>
                    </select>
                </div>
                
                <!-- CADASTUR Field (hidden by default) -->
                <div id="cadasturField" class="hidden mb-4">
                    <label for="registerCadastur" class="block text-sm font-medium text-gray-700 mb-2">N√∫mero CADASTUR</label>
                    <input type="text" id="registerCadastur" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"
                           placeholder="Digite seu n√∫mero CADASTUR">
                    <p class="text-xs text-gray-500 mt-1">Obrigat√≥rio para guias profissionais</p>
                    
                    <!-- CADASTUR Validation Status -->
                    <div id="cadasturValidation" class="hidden mt-2"></div>
                </div>
                
                <div id="registerError" class="hidden mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded"></div>
                <div id="registerSuccess" class="hidden mb-4 p-3 bg-green-100 border border-green-400 text-green-700 rounded"></div>
                
                <button type="submit" id="registerSubmit" 
                        class="w-full bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-md font-medium">
                    Cadastrar
                </button>
            </form>
            
            <div class="mt-4 text-center">
                <p class="text-sm text-gray-600">
                    J√° tem uma conta? 
                    <button id="switchToLogin" class="text-green-600 hover:text-green-700 font-medium">Fa√ßa login</button>
                </p>
            </div>
        </div>
    </div>

    <!-- Footer -->>
    <footer class="bg-gray-900 text-white py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-lg font-semibold mb-4">Trekko</h3>
                    <p class="text-gray-400">A plataforma mais completa para conectar trilheiros e guias em todo o Brasil.</p>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-4">Trilhas</h4>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="#" class="hover:text-white">Descobrir Trilhas</a></li>
                        <li><a href="#" class="hover:text-white">Trilhas Populares</a></li>
                        <li><a href="#" class="hover:text-white">Trilhas por Estado</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-4">Guias</h4>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="guias.html" class="hover:text-white">Encontrar Guias</a></li>
                        <li><a href="#" class="hover:text-white">Tornar-se Guia</a></li>
                        <li><a href="#" class="hover:text-white">Certifica√ß√£o</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-4">Suporte</h4>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="#" class="hover:text-white">Central de Ajuda</a></li>
                        <li><a href="#" class="hover:text-white">Contato</a></li>
                        <li><a href="#" class="hover:text-white">Termos de Uso</a></li>
                        <li><a href="#" class="hover:text-white">Privacidade</a></li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400">
                <p>&copy; 2025 Trekko. Todos os direitos reservados.</p>
            </div>
        </div>
    </footer>
</body>
</html>


    <script>
        // API Configuration
        const API_BASE_URL = 'https://g8h3ilcvjnlq.manus.space/api';
        
        // Authentication state
        let currentUser = null;
        let accessToken = null;
        let refreshToken = null;

        // DOM Elements
        const loginBtn = document.getElementById('loginBtn');
        const registerBtn = document.getElementById('registerBtn');
        const loginModal = document.getElementById('loginModal');
        const registerModal = document.getElementById('registerModal');
        const closeLoginModal = document.getElementById('closeLoginModal');
        const closeRegisterModal = document.getElementById('closeRegisterModal');
        const switchToRegister = document.getElementById('switchToRegister');
        const switchToLogin = document.getElementById('switchToLogin');
        const userMenu = document.getElementById('userMenu');
        const userName = document.getElementById('userName');
        const userMenuBtn = document.getElementById('userMenuBtn');
        const userDropdown = document.getElementById('userDropdown');
        const logoutBtn = document.getElementById('logoutBtn');

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthState();
            setupEventListeners();
        });

        function setupEventListeners() {
            // Modal controls
            loginBtn.addEventListener('click', () => showModal('login'));
            registerBtn.addEventListener('click', () => showModal('register'));
            closeLoginModal.addEventListener('click', () => hideModal('login'));
            closeRegisterModal.addEventListener('click', () => hideModal('register'));
            switchToRegister.addEventListener('click', () => switchModal('register'));
            switchToLogin.addEventListener('click', () => switchModal('login'));

            // User menu
            userMenuBtn.addEventListener('click', toggleUserDropdown);
            logoutBtn.addEventListener('click', logout);

            // Forms
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('registerForm').addEventListener('submit', handleRegister);

            // CADASTUR validation
            document.getElementById('registerUserType').addEventListener('change', handleUserTypeChange);
            document.getElementById('registerCadastur').addEventListener('input', debounce(validateCadastur, 500));
            document.getElementById('registerName').addEventListener('input', debounce(validateCadastur, 500));

            // Close modals on outside click
            window.addEventListener('click', function(e) {
                if (e.target === loginModal) hideModal('login');
                if (e.target === registerModal) hideModal('register');
            });
        }

        function checkAuthState() {
            // Verificar se h√° dados de usu√°rio salvos
            const userData = localStorage.getItem('userData');
            
            if (userData && userData !== 'null') {
                try {
                    currentUser = JSON.parse(userData);
                    showUserMenu();
                } catch (e) {
                    console.error('Erro ao parsear userData:', e);
                    showAuthButtons();
                }
            } else {
                showAuthButtons();
            }
        }

        function showUserMenu() {
            if (loginBtn) loginBtn.style.display = 'none';
            if (registerBtn) registerBtn.style.display = 'none';
            if (userMenu) userMenu.classList.remove('hidden');
            if (userName && currentUser) {
                userName.textContent = `U ${currentUser.name}`;
            }
        }

        function showAuthButtons() {
            loginBtn.style.display = 'block';
            registerBtn.style.display = 'block';
            userMenu.classList.add('hidden');
        }

        function showModal(type) {
            if (type === 'login') {
                loginModal.classList.remove('hidden');
                document.getElementById('loginEmail').focus();
            } else {
                registerModal.classList.remove('hidden');
                document.getElementById('registerName').focus();
            }
        }

        function hideModal(type) {
            if (type === 'login') {
                loginModal.classList.add('hidden');
                clearForm('loginForm');
            } else {
                registerModal.classList.add('hidden');
                clearForm('registerForm');
            }
        }

        function switchModal(type) {
            hideModal(type === 'login' ? 'register' : 'login');
            showModal(type);
        }

        function clearForm(formId) {
            document.getElementById(formId).reset();
            hideError(formId.replace('Form', 'Error'));
            hideSuccess(formId.replace('Form', 'Success'));
        }

        function toggleUserDropdown() {
            userDropdown.classList.toggle('hidden');
        }

        function handleUserTypeChange() {
            const userType = document.getElementById('registerUserType').value;
            const cadasturField = document.getElementById('cadasturField');
            
            if (userType === 'guia') {
                cadasturField.classList.remove('hidden');
                document.getElementById('registerCadastur').required = true;
            } else {
                cadasturField.classList.add('hidden');
                document.getElementById('registerCadastur').required = false;
                document.getElementById('cadasturValidation').classList.add('hidden');
            }
        }

        async function validateCadastur() {
            const cadastur = document.getElementById('registerCadastur').value.trim();
            const name = document.getElementById('registerName').value.trim();
            const userType = document.getElementById('registerUserType').value;
            const validationDiv = document.getElementById('cadasturValidation');

            if (userType !== 'guia' || !cadastur || !name) {
                validationDiv.classList.add('hidden');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/auth/validate-cadastur`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        cadastur_number: cadastur,
                        name: name
                    })
                });

                const data = await response.json();
                
                validationDiv.classList.remove('hidden');
                if (data.success) {
                    validationDiv.innerHTML = `<p class="text-sm text-green-600">‚úì ${data.message}</p>`;
                } else {
                    validationDiv.innerHTML = `<p class="text-sm text-red-600">‚úó ${data.message}</p>`;
                }
            } catch (error) {
                console.error('Erro na valida√ß√£o CADASTUR:', error);
            }
        }

        async function handleLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            const submitBtn = document.getElementById('loginSubmit');

            if (!email || !password) {
                showError('loginError', 'Email e senha s√£o obrigat√≥rios');
                return;
            }

            submitBtn.disabled = true;
            submitBtn.textContent = 'Entrando...';

            try {
                const response = await fetch(`${API_BASE_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();

                if (data.success) {
                    // Save auth data
                    localStorage.setItem('accessToken', data.access_token);
                    localStorage.setItem('refreshToken', data.refresh_token);
                    localStorage.setItem('currentUser', JSON.stringify(data.user));
                    
                    currentUser = data.user;
                    accessToken = data.access_token;
                    refreshToken = data.refresh_token;

                    hideModal('login');
                    showUserMenu();
                    showSuccess('loginSuccess', 'Login realizado com sucesso!');
                } else {
                    showError('loginError', data.message);
                }
            } catch (error) {
                showError('loginError', 'Erro de conex√£o. Tente novamente.');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Entrar';
            }
        }

        async function handleRegister(e) {
            e.preventDefault();
            
            const name = document.getElementById('registerName').value.trim();
            const email = document.getElementById('registerEmail').value.trim();
            const password = document.getElementById('registerPassword').value;
            const userType = document.getElementById('registerUserType').value;
            const cadastur = document.getElementById('registerCadastur').value.trim();
            const submitBtn = document.getElementById('registerSubmit');

            if (!name || !email || !password || !userType) {
                showError('registerError', 'Todos os campos s√£o obrigat√≥rios');
                return;
            }

            if (userType === 'guia' && !cadastur) {
                showError('registerError', 'N√∫mero CADASTUR √© obrigat√≥rio para guias');
                return;
            }

            submitBtn.disabled = true;
            submitBtn.textContent = 'Cadastrando...';

            try {
                const response = await fetch(`${API_BASE_URL}/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name,
                        email,
                        password,
                        user_type: userType,
                        cadastur_number: cadastur
                    })
                });

                const data = await response.json();

                if (data.success) {
                    // Save auth data
                    localStorage.setItem('accessToken', data.access_token);
                    localStorage.setItem('refreshToken', data.refresh_token);
                    localStorage.setItem('currentUser', JSON.stringify(data.user));
                    
                    currentUser = data.user;
                    accessToken = data.access_token;
                    refreshToken = data.refresh_token;

                    hideModal('register');
                    showUserMenu();
                    showSuccess('registerSuccess', 'Cadastro realizado com sucesso!');
                } else {
                    showError('registerError', data.message);
                }
            } catch (error) {
                showError('registerError', 'Erro de conex√£o. Tente novamente.');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Cadastrar';
            }
        }

        async function logout() {
            try {
                if (refreshToken) {
                    await fetch(`${API_BASE_URL}/auth/logout`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ refresh_token: refreshToken })
                    });
                }
            } catch (error) {
                console.error('Erro no logout:', error);
            } finally {
                // Clear local data
                localStorage.removeItem('accessToken');
                localStorage.removeItem('refreshToken');
                localStorage.removeItem('currentUser');
                
                currentUser = null;
                accessToken = null;
                refreshToken = null;

                showAuthButtons();
                userDropdown.classList.add('hidden');
            }
        }

        function showError(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.classList.remove('hidden');
        }

        function hideError(elementId) {
            const element = document.getElementById(elementId);
            element.classList.add('hidden');
        }

        function showSuccess(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.classList.remove('hidden');
            setTimeout(() => hideSuccess(elementId), 3000);
        }

        function hideSuccess(elementId) {
            const element = document.getElementById(elementId);
            element.classList.add('hidden');
        }
    </script>

    <!-- Sistema de Autentica√ß√£o Global -->
    <script src="auth.js"></script>
</body>
</html>

